{
	"homepage": "https://pc.weixin.qq.com/",
	"description": "Free messaging and calling app.",
	"version": "3.7.6",
	"license": {
		"identifier": "EULA",
		"url": "https://weixin.qq.com/cgi-bin/readtemplate?lang=zh_CN&t=weixin_agreement&s=default"
	},
	"url": "https://dldir1.qq.com/weixin/Windows/WeChatSetup.exe#/dl.7z",
	"shortcuts": [
		[
			"start.vbs",
			"WeChat",
			"",
			"wechat.exe"
		]
	],
	"post_install": [
		"Remove-Item \"$dir\\`$PLUGINSDIR\" -Force -Recurse",
		"Remove-Item \"$dir\\`$_15_\" -Force -Recurse",
		"Remove-Item \"$dir\\`$R5\" -Force -Recurse"
	],
	"installer": {
		"script": [
			"pip install psutil",
			"'import os,subprocess,time,psutil' | out-file -append $dir\\start.py -encoding ascii",
			"'def judgeprocess(processname):' | out-file -append $dir\\start.py -encoding ascii",
			"'    try:' | out-file -append $dir\\start.py -encoding ascii",
			"'        pl = psutil.pids()' | out-file -append $dir\\start.py -encoding ascii",
			"'        for pid in pl:' | out-file -append $dir\\start.py -encoding ascii",
			"'            if psutil.Process(pid).name() == processname:' | out-file -append $dir\\start.py -encoding ascii",
			"'                return 0' | out-file -append $dir\\start.py -encoding ascii",
			"'        else:' | out-file -append $dir\\start.py -encoding ascii",
			"'            return 1' | out-file -append $dir\\start.py -encoding ascii",
			"'    except:' | out-file -append $dir\\start.py -encoding ascii",
			"'        return 0' | out-file -append $dir\\start.py -encoding ascii",
			"'state = 0' | out-file -append $dir\\start.py -encoding ascii",
			"'wechat = r\"' + $dir + '\\WeChat.exe\"' | out-file -append $dir\\start.py -encoding ascii",
			"'dir_list = sorted(os.listdir(r\"' + $persist_dir + '\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\"),  key=lambda x: os.path.getmtime(os.path.join(r\"' + $persist_dir + '\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\", x)))' | out-file -append $dir\\start.py -encoding ascii",
			"'try:' | out-file -append $dir\\start.py -encoding ascii",
			"'    dir_list2 = sorted(os.listdir(os.environ.get(\"APPDATA\") + r\"\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\"),  key=lambda x: os.path.getmtime(os.path.join(os.environ.get(\"APPDATA\") + r\"\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\", x)))' | out-file -append $dir\\start.py -encoding ascii",
			"'    if dir_list[-1] != dir_list2[-1]:' | out-file -append $dir\\start.py -encoding ascii",
			"\"        os.system(r'powershell.exe `\"Move-Item `$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list2[-1] + ' \" + $persist_dir + \"\\WeChat\\XPlugin\\Plugins\\WMPFRuntime`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'        os.system(r\"rmdir /S /Q %APPDATA%\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\\" + dir_list[-1])' | out-file -append $dir\\start.py -encoding ascii",
			"'        os.system(r\"rmdir /S /Q ' + $persist_dir + '\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\\" + dir_list[-1])' | out-file -append $dir\\start.py -encoding ascii",
			"\"        os.system(r'powershell.exe `\"New-Item -Type Junction -Path `$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list2[-1] + r'\\extracted -Target \" + $persist_dir + \"\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list2[-1] + '\\extracted`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'    else:' | out-file -append $dir\\start.py -encoding ascii",
			"\"        print('not update')\" | out-file -append $dir\\start.py -encoding ascii",
			"'except:' | out-file -append $dir\\start.py -encoding ascii",
			"\"    os.system(r'powershell.exe `\"New-Item -Type Junction -Path `$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list[-1] + r'\\extracted -Target \" + $persist_dir + \"\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list[-1] + '\\extracted`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'    print(\"not exist\")' | out-file -append $dir\\start.py -encoding ascii",
			"'subprocess.Popen(wechat)' | out-file -append $dir\\start.py -encoding ascii",
			"'times = 0' | out-file -append $dir\\start.py -encoding ascii",
			"'while True:' | out-file -append $dir\\start.py -encoding ascii",
			"\"    process_name='LogonUI.exe'\" | out-file -append $dir\\start.py -encoding ascii",
			"\"    callall='TASKLIST'\" | out-file -append $dir\\start.py -encoding ascii",
			"'    outputall=subprocess.check_output(callall)' | out-file -append $dir\\start.py -encoding ascii",
			"'    outputstringall=str(outputall)' | out-file -append $dir\\start.py -encoding ascii",
			"'    if process_name in outputstringall:' | out-file -append $dir\\start.py -encoding ascii",
			"'        print(\"Locked.\")' | out-file -append $dir\\start.py -encoding ascii",
			"'        if state == 0 and times >= 120:' | out-file -append $dir\\start.py -encoding ascii",
			"'            state = 1' | out-file -append $dir\\start.py -encoding ascii",
			"\"            os.system('taskkill /F /IM `\"WeChat.exe`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'        elif times < 120:' | out-file -append $dir\\start.py -encoding ascii",
			"'            times += 1' | out-file -append $dir\\start.py -encoding ascii",
			"'    else:' | out-file -append $dir\\start.py -encoding ascii",
			"'        print(\"Unlocked.\")' | out-file -append $dir\\start.py -encoding ascii",
			"'        if state == 1:' | out-file -append $dir\\start.py -encoding ascii",
			"'            state = 0' | out-file -append $dir\\start.py -encoding ascii",
			"'            times = 0' | out-file -append $dir\\start.py -encoding ascii",
			"'            dir_list = sorted(os.listdir(r\"' + $persist_dir + '\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\"),  key=lambda x: os.path.getmtime(os.path.join(r\"' + $persist_dir + '\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\", x)))' | out-file -append $dir\\start.py -encoding ascii",
			"'            try:' | out-file -append $dir\\start.py -encoding ascii",
			"'                dir_list2 = sorted(os.listdir(os.environ.get(\"APPDATA\") + r\"\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\"),  key=lambda x: os.path.getmtime(os.path.join(os.environ.get(\"APPDATA\") + r\"\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\", x)))' | out-file -append $dir\\start.py -encoding ascii",
			"'                if dir_list[-1] != dir_list2[-1]:' | out-file -append $dir\\start.py -encoding ascii",
			"\"                    os.system(r'powershell.exe `\"Move-Item `$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list2[-1] + ' \" + $persist_dir + \"\\WeChat\\XPlugin\\Plugins\\WMPFRuntime`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'                    os.system(r\"rmdir /S /Q %APPDATA%\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\\" + dir_list[-1])' | out-file -append $dir\\start.py -encoding ascii",
			"'                    os.system(r\"rmdir /S /Q ' + $persist_dir + '\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\\" + dir_list[-1])' | out-file -append $dir\\start.py -encoding ascii",
			"\"                    os.system(r'powershell.exe `\"New-Item -Type Junction -Path `$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list2[-1] + r'\\extracted -Target \" + $persist_dir + \"\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list2[-1] + '\\extracted`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'                else:' | out-file -append $dir\\start.py -encoding ascii",
			"\"                    print('not update')\" | out-file -append $dir\\start.py -encoding ascii",
			"'            except:' | out-file -append $dir\\start.py -encoding ascii",
			"\"                os.system(r'powershell.exe `\"New-Item -Type Junction -Path `$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list[-1] + r'\\extracted -Target \" + $persist_dir + \"\\WeChat\\XPlugin\\Plugins\\WMPFRuntime\\\\' + dir_list[-1] + '\\extracted`\"')\" | out-file -append $dir\\start.py -encoding ascii",
			"'                print(\"not exist\")' | out-file -append $dir\\start.py -encoding ascii",
			"'            subprocess.Popen(wechat)' | out-file -append $dir\\start.py -encoding ascii",
			"\"        elif judgeprocess('WeChat.exe') == 1:\" | out-file -append $dir\\start.py -encoding ascii",
			"'            exit()' | out-file -append $dir\\start.py -encoding ascii",
			"'    time.sleep(5)' | out-file -append $dir\\start.py -encoding ascii",
			"'set ws=WScript.CreateObject(\"WScript.Shell\")' | out-file -append $dir\\start.vbs -encoding ascii",
			"$python = $scoopdir.toString() + \"\\shims\\python.exe\" -replace \"\\\\\", \"\\\\\"",
			"$script = $dir.toString() + \"\\start.py\" -replace \"\\\\\", \"\\\\\"",
			"'ws.Run \"python ' + $script + '\",0' | out-file -append $dir\\start.vbs -encoding ascii",
			"'$triggers = @()' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$CIMTriggerClass = Get-CimClass -ClassName MSFT_TaskEventTrigger -Namespace Root/Microsoft/Windows/TaskScheduler:MSFT_TaskEventTrigger' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$trigger = New-CimInstance -CimClass $CIMTriggerClass -ClientOnly' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$trigger.Subscription = \"<QueryList><Query Id=`\"0`\" Path=`\"System`\"><Select Path=`\"System`\">*[System[Provider[@Name=' + \"'Microsoft-Windows-Kernel-Power'] and EventID=42]]</Select></Query></QueryList>\" + '\"' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$trigger.Enabled = $True' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$triggers += $trigger' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$CIMTriggerClass = Get-CimClass -ClassName MSFT_TaskEventTrigger -Namespace Root/Microsoft/Windows/TaskScheduler:MSFT_TaskEventTrigger' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$trigger = New-CimInstance -CimClass $CIMTriggerClass -ClientOnly' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$trigger.Subscription = \"<QueryList><Query Id=`\"0`\" Path=`\"System`\"><Select Path=`\"System`\">*[System[Provider[@Name=' + \"'Microsoft-Windows-Kernel-Power'] and EventID=1074]]</Select></Query></QueryList>\" + '\"' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$trigger.Enabled = $True' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$triggers += $trigger' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$User=\"Nt Authority\\System\"' | out-file -append $dir\\register.ps1 -encoding ascii",
			"'$Action=New-ScheduledTaskAction -Execute \"cmd.exe\" -Argument \"/c taskkill /f /im WeChat.exe\"' | out-file -append $dir\\register.ps1 -encoding ascii",
			"\"Register-ScheduledTask -TaskName 'WeChat Shutdown' -Trigger `$triggers -User `$User -Action `$Action -RunLevel Highest -Force\" | out-file -append $dir\\register.ps1 -encoding ascii",
			"start-process powershell -ArgumentList \"-noprofile -file $dir\\register.ps1\" -verb RunAs -WindowStyle hidden -wait",
			"if (Test-Path \"$persist_dir\\WeChat\") {",
			"    Remove-Item \"$env:APPDATA\\Tencent\\WeChat\" -Force -Recurse -ErrorAction SilentlyContinue",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\1\" -Target \"$persist_dir\\WeChat\\1\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\All Users\" -Target \"$persist_dir\\WeChat\\All Users\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\bak\" -Target \"$persist_dir\\WeChat\\bak\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\cdn\" -Target \"$persist_dir\\WeChat\\cdn\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\log\" -Target \"$persist_dir\\WeChat\\log\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\wmpf\" -Target \"$persist_dir\\WeChat\\wmpf\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\xweb\" -Target \"$persist_dir\\WeChat\\xweb\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Info\" -Target \"$persist_dir\\WeChat\\XPlugin\\Info\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\CourgettePatch\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\CourgettePatch\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\FinderLive\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\FinderLive\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\RadiumWMPF\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\RadiumWMPF\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\ThumbPlayer\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\ThumbPlayer\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\UpdateNotify\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\UpdateNotify\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WeChatUpdate\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\WeChatUpdate\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\XFilesOfficeReader\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\XFilesOfficeReader\" | Out-Null",
			"    New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\XWeb\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\XWeb\" | Out-Null",
			"} else {",
			"    if (Test-Path \"$env:APPDATA\\Tencent\\WeChat\") {",
			"        Move-Item \"$env:APPDATA\\Tencent\\WeChat\" \"$persist_dir\\WeChat\" -Force",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\1\" -Target \"$persist_dir\\WeChat\\1\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\All Users\" -Target \"$persist_dir\\WeChat\\All Users\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\bak\" -Target \"$persist_dir\\WeChat\\bak\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\cdn\" -Target \"$persist_dir\\WeChat\\cdn\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\log\" -Target \"$persist_dir\\WeChat\\log\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\wmpf\" -Target \"$persist_dir\\WeChat\\wmpf\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\xweb\" -Target \"$persist_dir\\WeChat\\xweb\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Info\" -Target \"$persist_dir\\WeChat\\XPlugin\\Info\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\CourgettePatch\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\CourgettePatch\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\FinderLive\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\FinderLive\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\RadiumWMPF\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\RadiumWMPF\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\ThumbPlayer\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\ThumbPlayer\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\UpdateNotify\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\UpdateNotify\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\WeChatUpdate\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\WeChatUpdate\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\XFilesOfficeReader\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\XFilesOfficeReader\" | Out-Null",
			"        New-Item -Type Junction -Path \"$env:APPDATA\\Tencent\\WeChat\\XPlugin\\Plugins\\XWeb\" -Target \"$persist_dir\\WeChat\\XPlugin\\Plugins\\XWeb\" | Out-Null",
			"    }",
			"}"
		]
	},
	"uninstaller": {
		"script": [
			"Start-Process powershell \"unregister-scheduledtask -taskname 'WeChat Shutdown' -confirm:`$false\" -Verb RunAs -WindowStyle hidden -wait",
			"if (!(Test-Path \"$persist_dir\\WeChat\")) {",
			"    Move-Item \"$env:APPDATA\\Tencent\\WeChat\" \"$persist_dir\\WeChat\" -Force",
			"} else {",
			"    Remove-Item \"$env:APPDATA\\Tencent\\WeChat\" -Force -Recurse -ErrorAction SilentlyContinue",
			"}"
		]
	},
	"checkver": "<span class=\"download-version\">([\\d.]+)</span>",
	"autoupdate": {
		"url": "https://dldir1.qq.com/weixin/Windows/WeChatSetup.exe#/dl.7z"
	},
	"persist": "WeChat",
	"hash": "md5:3d26396deef84239fdfabff06d7b3e35"
}